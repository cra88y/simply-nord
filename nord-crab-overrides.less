/* ==========================================================================
   Simply-Nord Theme Overrides - FINAL (v8)
   - Definitive version addressing all specificity and layout regressions.
   - Correctly overrides responsive stacking by targeting the same context
     as the base theme, eliminating the need for "!important".
   ========================================================================== */

/* --- 1. Variable Definitions & Overrides --- */

// Nord Color Palette
@nord01: #1d2128;
@nord0: #2e3440;
@nord1: #3b4252;
@nord2: #434c5e;
@nord3: #4c566a;
@nord4: #d8dee9;
@nord5: #e5e9f0;
@nord6: #eceff4;
@nord7: #8fbcbb;
@nord8: #88c0d0;
@nord9: #81a1c1;
@nord10: #5e81ac;
@nord11: #bf616a;
@nord12: #d08770;
@nord13: #ebcb8b;
@nord14: #a3be8c;
@nord15: #b48ead;

// Layout Variable Overrides
@results-width: 45rem;
@results-sidebar-width: 25rem;
@results-offset: 10rem;
@results-gap: 5rem;
@search-width: 52rem;
@result-padding: 0.5rem 1rem;
@results-margin: 0;
@phone: 50em;
@tablet: 79.75em;

/* --- 2. Visual Removals & Global Tweaks --- */
footer,
.link_on_top_about,
.link_on_top_donate,
#search_logo,
.title h1,
.dialog-warning-block,
#language,
#safesearch {
    display: none !important;
}

html {
    line-height: 1.25;
    -webkit-font-smoothing: antialiased;
    text-rendering: optimizelegibility;
    font-variant-numeric: proportional-nums;
}

#q::placeholder {
    color: transparent;
}

#links_on_top {
    font-size: 1.25rem;
    top: 1.4rem;
}

/* --- 3. Component Style Overrides --- */

// General Rounded Aesthetic & Shadow
.rounded-corners(@radius: 50px) {
    border-radius: @radius;
}

.rounded-corners-tiny(@radius: 25px) {
    border-radius: @radius;
}

.ltr-rounded-right-corners(@radius: 25px) {
    border-radius: @radius;
}

.result img.thumbnail,
.result-images img,
#sidebar .infobox img {
    border-radius: 25px;
    box-shadow: var(--color-search-shadow);
}

// Search Header & Box
#search_header {
    padding-top: 1rem;
    gap: 0.5rem;
    border-bottom: none;
}

.search_box {
    max-width: @search-width;
    border-radius: 50px;
}

#q,
#send_search,
#clear_search {
    padding: 0.8rem 1rem;
    font-size: 1.125rem;
}

#q {
    border-radius: 50px 0 0 50px;
}

#send_search {
    padding-right: 1.5rem;
    border-radius: 0 50px 50px 0;
}

#clear_search {
    width: 2rem;
    padding: 0.8rem 0.2rem;
}

// Autocomplete & Mobile Overlay
.autocomplete {
    min-width: @search-width;
    border-radius: 0;
    max-height: 0;

    &:active,
    &:focus,
    &:hover {
        background-color: var(--color-header-background);
    }

    >ul>li {
        padding: 1rem;
    }

    &.open {
        display: none;
        max-height: 100dvh !important;
        margin-top: 3.5rem;
        border-radius: 0 0 25px 25px;
    }
}

#search_view:focus-within>.search_box>.autocomplete.open {
    display: block;
}

// Categories & Filters
button.category_button {
    padding: 0.25rem 1rem;
    text-transform: lowercase;
    font-size: 1rem;

    &:active {
        background-color: rgba(0, 0, 0, 0.05);
        transition: 0s;
    }
}

.search_filters {
    margin-top: 0;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;

    &::-webkit-scrollbar {
        display: none;
    }
}

select {
    padding: 0.25rem 0.5rem !important;
    background-size: 1.5rem;
}

// Results Grid Layout
#results {
    margin-top: 0.125rem;
    margin-left: @results-offset;
    grid-template:
        "header sidebar" min-content
        "corrections sidebar" min-content
        "answers sidebar" min-content
        "urls sidebar" 1fr
        "pagination sidebar" min-content
        / @results-width @results-sidebar-width;
}

#results-header {
    grid-area: header;
}

// Result Cards
.result {
    border-left-width: 0;
    position: relative;
    padding-bottom: 1.5rem;

    h3 {
        font-size: 1.125rem;
        margin: 0.125rem 0 0 0;
    }

    .content,
    .stat {
        display: inline;
        hyphens: auto;
        overflow: hidden;
    }

    img.thumbnail {
        float: right;
        margin: 0.25rem 0 0.25rem 1rem;
        border: none;
        max-width: 45%;
        max-height: 10rem;
        height: auto;
        object-fit: contain;
    }
}

.result-videos {
    img.thumbnail {
        float: left !important;
        margin: 0 1rem 0.5rem 0 !important;
        max-width: 35%;
    }

    .content {
        display: block;
        max-height: none;
    }
}

.category-videos,
.category-news,
.category-map,
.category-music,
.category-files,
.category-social {
    border: none !important;
    margin: 0 0 1rem 0 !important;
}

.engines {
    position: absolute;
    bottom: 0.5rem;
    right: 1rem;
    filter: blur(0.5px);
    text-align: end;
    font-size: 0.9rem;
    margin-top: 0.125rem;
}

// Image Results Page Layout
#main_results div#results.only_template_images {
    #urls {
        display: flex;
        flex-wrap: wrap;
        justify-content: flex-start;
        gap: 0.5rem;
    }

    .result-images {
        padding: 0.25rem;
        height: auto;
        flex-basis: calc(50% - 1rem);
        flex-grow: 1;
        max-width: calc(50% - 1rem);

        >a {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
            overflow: hidden;
        }

        img {
            width: 100%;
            height: auto;
            object-fit: contain;
            border: none;
        }

        .image_resolution,
        span.title,
        span.source {
            position: static;
            display: block;
            width: 100%;
            padding: 0.125rem 0 0 0;
            flex-shrink: 0;
        }
    }
}

// Suggestions
#suggestions {
    margin-left: 0;
    width: @results-width;

    .wrapper {
        display: flex;
        flex-flow: row nowrap;
        justify-content: flex-start;
        width: 100%;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        padding-bottom: 0.25rem;

        &::-webkit-scrollbar {
            display: none;
        }

        form {
            display: inline-block;
            flex: 0 0 auto;
            border-radius: 50px;
            border: 0.125rem solid #0002;
            background: var(--color-header-background);
            padding: 0.125rem 0.5rem;
            margin: 0.125rem;
        }
    }

    input {
        color: @nord7;
        border-radius: 0;
        overflow: hidden;
        text-decoration: none;
    }
}

// Sidebar & Answers
#answers,
#sidebar .infobox {
    background: var(--color-header-background);
    padding: 1.5rem;
    margin: 0.5rem 0;
    border: none;
}

.sidebar-collapsible,
#sidebar-end-collapsible {
    border: none;
}

#sidebar .infobox .urls ul,
#sidebar .infobox .urls li {
    list-style: none;
    padding-left: 0;
    margin-left: 0;
}

// Rounded response time bars
.stacked-bar-chart>div {
    border-radius: 50px;
}

// Home Page
#main_index {
    margin-top: 33vh;
}

.index_endpoint {
    background: var(--color-header-background);
}

// Misc
#backToTop {
    border: none;
    background: var(--color-header-background);
    transition: opacity 0.2s;
}

input.checkbox-onoff[type="checkbox"]::before {
    transition: left 0.1s;
}

// --- 4. RESPONSIVE OVERRIDES (THE DEFINITIVE FIX) ---

// This is the mixin that needs to be overridden.
// By redefining it here, we ensure our stacking logic is used.
.results-tablet() {
    #main_results div#results {
        grid-template:
            "header" min-content
            "corrections" min-content
            "answers" min-content
            "sidebar" min-content
            "urls" 1fr
            "pagination" min-content
            / 100%;
        margin-left: 0;
        width: 100%;
        box-sizing: border-box;
        padding: 0 0.5rem;
    }

    .search_filters,
    #suggestions {
        margin-left: 0.5rem;
        width: auto;
        max-width: calc(100vw - 1rem);
    }

    #categories {
        overflow-x: auto;
        scrollbar-width: none;

        &::-webkit-scrollbar {
            display: none;
        }

        #categories_container {
            width: max-content;
        }
    }

    #backToTop {
        display: none;
    }
}

@media screen and (max-width: @tablet) {
    .results-tablet();
}

@media screen and (max-width: @phone) {
    .autocomplete {
        min-width: 100%;
    }

    #main_results div#results.only_template_images .result-images {
        flex-basis: calc(50% - 0.5rem);
        max-width: calc(50% - 0.5rem);
        max-height: 40vh;
        width: 45vw;
    }

    #search_view:focus-within {
        display: block;
        background-color: var(--color-header-background);
        position: absolute;
        top: 0;
        height: 100%;
        max-width: 100dvw;
        width: 100%;
        z-index: 2000;
        padding: 0 !important;
        box-sizing: border-box;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        border-radius: 0 0 25px 25px;

        &::-webkit-scrollbar {
            display: none;
        }

        .search_box {
            border-bottom: 1px solid var(--color-search-border);
            border-radius: 0;
            box-shadow: none;
            padding: 0;
        }
    }
}

/* --- 5. Color Theme Variable Overrides --- */

// Light Theme (Default)
:root {
    --color-base-font: @nord1;
    --color-base-background: @nord6;
    --color-base-background-mobile: @nord5;
    --color-url-font: @nord10;
    --color-url-visited-font: @nord15;
    --color-header-background: @nord6;
    --color-header-border: @nord4;
    --color-footer-background: @nord6;
    --color-footer-border: @nord4;
    --color-sidebar-border: @nord4;
    --color-sidebar-font: @nord1;
    --color-sidebar-background: @nord5;
    --color-backtotop-font: @nord1;
    --color-backtotop-border: @nord4;
    --color-backtotop-background: @nord6;
    --color-btn-background: @nord9;
    --color-btn-font: @nord6;
    --color-show-btn-background: @nord4;
    --color-show-btn-font: @nord1;
    --color-search-border: @nord4;
    --color-search-shadow: 0 2px 8px rgba(46, 52, 64, 0.15);
    --color-search-background: @nord6;
    --color-search-font: @nord0;
    --color-search-background-hover: @nord9;
    --color-error: @nord11;
    --color-error-background: #f2e0e2;
    --color-warning: @nord12;
    --color-warning-background: #fcf8f6;
    --color-success: @nord14;
    --color-success-background: #fefefe;
    --color-categories-item-selected-font: @nord10;
    --color-categories-item-border-selected: @nord10;
    --color-autocomplete-font: @nord0;
    --color-autocomplete-border: @nord4;
    --color-autocomplete-shadow: 0 2px 8px rgba(46, 52, 64, 0.1);
    --color-autocomplete-background: @nord6;
    --color-autocomplete-background-hover: @nord5;
    --color-answer-font: @nord1;
    --color-answer-background: @nord5;
    --color-result-keyvalue-col-table: @nord5;
    --color-result-keyvalue-odd: @nord5;
    --color-result-keyvalue-even: @nord6;
    --color-result-background: @nord6;
    --color-result-border: @nord4;
    --color-result-url-font: @nord3;
    --color-result-vim-selected: @nord5;
    --color-result-vim-arrow: @nord9;
    --color-result-description-highlight-font: @nord1;
    --color-result-link-font: @nord10;
    --color-result-link-font-highlight: @nord7;
    --color-result-link-visited-font: @nord15;
    --color-result-publishdate-font: @nord2;
    --color-result-engines-font: @nord3;
    --color-result-search-url-border: @nord4;
    --color-result-search-url-font: @nord1;
    --color-result-image-span-font: @nord1;
    --color-result-image-span-font-selected: @nord6;
    --color-result-image-background: @nord6;
    --color-settings-tr-hover: @nord5;
    --color-settings-engine-description-font: @nord2;
    --color-settings-table-group-background: rgba(76, 86, 106, 0.1);
    --color-result-detail-font: @nord4;
    --color-result-detail-label-font: @nord3;
    --color-result-detail-background: @nord0;
    --color-result-detail-hr: @nord2;
    --color-result-detail-link: @nord8;
    --color-result-detail-loader-border: rgba(216, 222, 233, 0.2);
    --color-result-detail-loader-borderleft: rgba(46, 52, 64, 0);
    --color-toolkit-badge-font: @nord6;
    --color-toolkit-badge-background: @nord3;
    --color-toolkit-kbd-font: @nord6;
    --color-toolkit-kbd-background: @nord1;
    --color-toolkit-dialog-border: @nord4;
    --color-toolkit-dialog-background: @nord6;
    --color-toolkit-tabs-label-border: @nord6;
    --color-toolkit-tabs-section-border: @nord4;
    --color-toolkit-select-background: @nord5;
    --color-toolkit-select-border: @nord4;
    --color-toolkit-select-background-hover: @nord4;
    --color-toolkit-input-text-font: @nord0;
    --color-toolkit-checkbox-onoff-off-background: @nord4;
    --color-toolkit-checkbox-onoff-on-background: @nord9;
    --color-toolkit-checkbox-onoff-on-mark-background: @nord14;
    --color-toolkit-checkbox-onoff-on-mark-color: @nord6;
    --color-toolkit-checkbox-onoff-off-mark-background: @nord11;
    --color-toolkit-checkbox-onoff-off-mark-color: @nord6;
    --color-toolkit-checkbox-label-background: @nord5;
    --color-toolkit-checkbox-label-border: @nord4;
    --color-toolkit-checkbox-input-border: @nord9;
    --color-toolkit-engine-tooltip-border: @nord4;
    --color-toolkit-engine-tooltip-background: @nord6;
    --color-toolkit-loader-border: rgba(59, 66, 82, 0.2);
    --color-toolkit-loader-borderleft: rgba(236, 239, 244, 0);
    --color-doc-code: @nord1;
    --color-doc-code-background: @nord5;
    --color-bar-chart-primary: @nord8;
    --color-bar-chart-secondary: @nord13;
    --color-image-resolution-background: rgba(46, 52, 64, 0.5);
    --color-image-resolution-font: @nord6;
    --color-loading-indicator: rgba(59, 66, 82, 0.2);
    --color-loading-indicator-gap: @nord6;
    --color-line-number: @nord3;
    --color-favicon-background-color: @nord5;
    --color-favicon-border-color: @nord4;
}

// Dark & Auto-Dark Themes
.dark-themes() {
    --color-base-font: @nord4;
    --color-base-background: @nord0;
    --color-base-background-mobile: @nord0;
    --color-url-font: @nord7;
    --color-url-visited-font: @nord15;
    --color-header-background: @nord01;
    --color-header-border: @nord1;
    --color-footer-background: @nord0;
    --color-footer-border: @nord1;
    --color-sidebar-border: @nord3;
    --color-sidebar-font: @nord4;
    --color-sidebar-background: @nord1;
    --color-backtotop-font: @nord4;
    --color-backtotop-border: @nord1;
    --color-backtotop-background: @nord2;
    --color-btn-background: @nord9;
    --color-btn-font: @nord6;
    --color-show-btn-background: @nord3;
    --color-show-btn-font: @nord5;
    --color-search-border: @nord3;
    --color-search-shadow: 0 4px 16px rgba(46, 52, 64, 0.9);
    --color-search-background: @nord0;
    --color-search-font: @nord5;
    --color-search-background-hover: @nord9;
    --color-error: @nord11;
    --color-error-background: @nord2;
    --color-warning: @nord12;
    --color-warning-background: @nord2;
    --color-success: @nord14;
    --color-success-background: @nord2;
    --color-categories-item-selected-font: @nord8;
    --color-categories-item-border-selected: @nord8;
    --color-autocomplete-font: @nord5;
    --color-autocomplete-border: @nord3;
    --color-autocomplete-shadow: 0 2px 8px rgba(46, 52, 64, 0.25);
    --color-autocomplete-background: @nord1;
    --color-autocomplete-background-hover: @nord2;
    --color-answer-font: @nord4;
    --color-answer-background: @nord1;
    --color-result-keyvalue-col-table: @nord1;
    --color-result-keyvalue-odd: @nord1;
    --color-result-keyvalue-even: @nord0;
    --color-result-background: @nord0;
    --color-result-border: @nord1;
    --color-result-url-font: @nord5;
    --color-result-vim-selected: rgba(67, 76, 94, 0.8);
    --color-result-vim-arrow: @nord9;
    --color-result-description-highlight-font: @nord6;
    --color-result-link-font: @nord8;
    --color-result-link-font-highlight: @nord7;
    --color-result-link-visited-font: @nord12;
    --color-result-publishdate-font: @nord4;
    --color-result-engines-font: @nord8;
    --color-result-search-url-border: @nord3;
    --color-result-search-url-font: @nord5;
    --color-result-detail-font: @nord5;
    --color-result-detail-label-font: @nord4;
    --color-result-detail-background: @nord0;
    --color-result-detail-hr: @nord3;
    --color-result-detail-link: @nord7;
    --color-result-detail-loader-border: rgba(216, 222, 233, 0.2);
    --color-result-detail-loader-borderleft: rgba(46, 52, 64, 0);
    --color-result-image-span-font: @nord4;
    --color-result-image-span-font-selected: @nord0;
    --color-result-image-background: @nord0;
    --color-settings-tr-hover: @nord2;
    --color-settings-engine-description-font: @nord4;
    --color-settings-table-group-background: @nord1;
    --color-toolkit-badge-font: @nord5;
    --color-toolkit-badge-background: @nord3;
    --color-toolkit-kbd-font: @nord0;
    --color-toolkit-kbd-background: @nord5;
    --color-toolkit-dialog-border: @nord3;
    --color-toolkit-dialog-background: @nord1;
    --color-toolkit-tabs-label-border: @nord0;
    --color-toolkit-tabs-section-border: @nord3;
    --color-toolkit-select-background: @nord2;
    --color-toolkit-select-border: @nord3;
    --color-toolkit-select-background-hover: @nord3;
    --color-toolkit-input-text-font: @nord5;
    --color-toolkit-checkbox-onoff-off-background: @nord2;
    --color-toolkit-checkbox-onoff-on-background: @nord4;
    --color-toolkit-checkbox-onoff-on-mark-background: @nord14;
    --color-toolkit-checkbox-onoff-on-mark-color: @nord0;
    --color-toolkit-checkbox-onoff-off-mark-background: @nord11;
    --color-toolkit-checkbox-onoff-off-mark-color: @nord0;
    --color-toolkit-checkbox-label-background: @nord1;
    --color-toolkit-checkbox-label-border: @nord3;
    --color-toolkit-checkbox-input-border: @nord9;
    --color-toolkit-engine-tooltip-border: @nord1;
    --color-toolkit-engine-tooltip-background: @nord2;
    --color-toolkit-loader-border: rgba(216, 222, 233, 0.2);
    --color-toolkit-loader-borderleft: rgba(46, 52, 64, 0);
    --color-doc-code: @nord5;
    --color-doc-code-background: @nord2;
    --color-favicon-background-color: @nord4;
    --color-favicon-border-color: @nord3;
}

// Black Theme
.black-themes() {
    --color-base-background: #000;
    --color-base-background-mobile: #000;
    --color-header-background: #000;
    --color-footer-background: #000;
    --color-sidebar-background: #000;
    --color-search-background: #000;
    --color-autocomplete-background: #000;
    --color-answer-background: #000;
    --color-result-keyvalue-even: #000;
    --color-result-background: #000;
    --color-result-detail-background: #000;
    --color-result-image-background: #000;
    --color-toolkit-dialog-background: #000;
    --color-toolkit-tabs-label-border: #000;
}

// Apply Dark/Black Themes
:root.theme-dark {
    .dark-themes();
}

:root.theme-black {
    .dark-themes();
    .black-themes();
}

@media (prefers-color-scheme: dark) {
    :root.theme-auto {
        .dark-themes();
    }
}